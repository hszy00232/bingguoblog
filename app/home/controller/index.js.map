{
    "version": 3,
    "sources": [
        "../../../src/home/controller/index.js"
    ],
    "names": [],
    "mappings": "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",
    "file": "../../../src/home/controller/index.js",
    "sourcesContent": [
        "'use strict';\n\nimport Base from './base.js';\n\n\nexport default class extends Base {\n  /**\n   * index\n   * @return {[type]} [description]\n   */\n  indexAction(){\n    return this.action('post', 'list');\n  }\n  /**\n   * rss\n   * @return {[type]} [description]\n   */\n  async rssAction(){\n    let model = this.model('post');\n    let list = await model.getPostRssList();\n    this.assign('list', list);\n    this.assign('currentTime', (new Date()).toString());\n\n    this.type('text/xml');\n    return super.display(this.HOME_VIEW_PATH + 'rss.xml');\n  }\n\n  /**\n   * sitemap action\n   * @return {[type]} [description]\n   */\n  async sitemapAction(){\n    let model = this.model('post');\n    let list = model.getPostSitemapList();\n    this.assign('list', list);\n\n    this.type('text/xml');\n    return this.display(this.HOME_VIEW_PATH + 'sitemap.xml');\n  }\n  /**\n   * install\n   * @return {[type]} [description]\n   */\n  async installAction(){\n    if(this.isGet()){\n      if(firekylin.isInstalled){\n        return this.redirect('/');\n      }\n      return this.display();\n    }\n    if(firekylin.isInstalled){\n      return this.fail('SYSTERM_INSTALLED');\n    }\n\n    let errors = this.assign('errors');\n    if(!think.isEmpty(errors)){\n      this.assign('message', errors[Object.keys(errors)[0]]);\n      return this.display();\n    }\n\n    let data = this.post();\n    let dbInfo = {\n      host: data.db_host,\n      port: data.db_port,\n      database: data.db_name,\n      user: data.db_account,\n      password: data.db_password,\n      prefix: data.db_table_prefix\n    }\n    let account = {\n      username: data.username,\n      password: data.password\n    }\n    let InstallService = this.service('install');\n    let instance = new InstallService(dbInfo, account, this.ip());\n    let message = 'success';\n    await instance.run().catch(err => {\n      message = err;\n    });\n    this.assign('message', message);\n    this.assign('data', data);\n    this.display();\n  }\n  /**\n   * 申请成为投稿者\n   * @return {[type]} [description]\n   */\n  async contributorAction() {\n    if( !this.options.hasOwnProperty('push') || this.options.push == 0) {\n      return this.fail('推送申请功能未开启');\n    }\n    if( this.isGet() ) {\n      return this.display();\n    }\n\n    let user = this.post();\n    user.type = firekylin.USER_CONTRIBUTOR;\n    user.status = firekylin.USER_DISABLED;\n    user.create_time = think.datetime();\n    user.last_login_time = user.create_time;\n    user.create_ip = this.ip();\n    user.last_login_ip = this.ip();\n\n    await this.model('user').where({name: user.name, email: user.email, _logic: 'OR'}).thenAdd(user);\n    this.assign('message', 'success');\n    this.display();\n  }\n}\n"
    ]
}